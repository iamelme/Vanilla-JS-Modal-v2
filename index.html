<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="assets/css/style.css">
  <title>Modal</title>
</head>
<body>

  <div class="wrapper">
    <div class="container">
      <button class="btn btn-open" id="btn1" data-modal="#modal1">Open</button>
      <div class="modal" id="modal1">
        <div class="modal-content">modal</div>
      </div>
      <button class="btn btn-open" id="btn2" data-modal="#modal2">Open</button>
      <div class="modal" id="modal2">
        <div class="modal-content">modal2</div>
      </div>
    </div>
  </div>

  <script>
    (function(){

      let d = document,
          btnOpener = null,
          btnType = null,
          targetElem = null;

      this.Modal = function() {

        this.modal = null
        this.pop = false
        this.closeBtn = null
        this.overlay = null

        let defaults = {
          el: ".btn-open",
          className: "elme-pop",
          minWidth: 320,
          maxWidth: 600,
          closeBtn: "x"
        }

        if (arguments[0] && typeof arguments[0] === 'object') {
          this.options = extendOptions(defaults, arguments[0])
        }      
        
        // methods
        function extendOptions (source, properties) {
          for ( var property in properties ) {
            if (properties.hasOwnProperty(property))
              source[property] = properties[property]
          }
          return source
        }

        function createModalElem () {
          let frag = document.createDocumentFragment();

          this.modal.classList.add('open')
          this.modal.style.minWidth = this.options.minWidth + 'px'
          this.modal.style.maxWidth = this.options.maxWidth + 'px'
          this.overlay = d.createElement('div')
          this.overlay.classList.add('overlay')
          frag.appendChild(this.overlay)
          
          // if (typeof this.options.closeBtn === 'string' && this.options.closeBtn[0] != '<') { 
          if (typeof this.options.closeBtn === 'string') { 
          // if (this.options.closeBtn.nodeType === 1) {
            this.closeBtn = d.createElement('button')
            this.closeBtn.classList.add('modal-close')
            this.closeBtn.innerHTML = this.options.closeBtn
            this.modal.appendChild(this.closeBtn)
            this.modal.classList.add(this.options.className)
          } 

          d.body.appendChild(frag);
        }

        function closeEvents (btn) {
          let _ = this;

          window.addEventListener('keydown', _.close.bind(_, btn))

          if (this.closeBtn) 
            this.closeBtn.addEventListener('click', this.close.bind(this, btn));

          if (this.overlay)
            this.overlay.addEventListener('click', this.close.bind(this, btn));
        }

        Modal.prototype.open = function(el) {
          if (!this.pop && !el.classList.contains('triggered')) {
            this.modal = d.querySelector(el.getAttribute('data-modal'))
            this.pop = true
            el.classList.add('triggered')
            createModalElem.call(this)
          }

          closeEvents.call(this, el)
        }

        Modal.prototype.close = function (btn) {

          let _ = this;
          if (_.pop || _.modal) {
            _.pop = false
            _.modal.classList.remove('open')
            _.modal.classList.remove(_.options.className)
            if (_.closeBtn) {
              _.modal.removeChild(_.closeBtn)
              btn.classList.remove('triggered')
            }
            if (_.overlay) {
              _.overlay.parentNode.removeChild(_.overlay)
              btn.classList.remove('triggered')
            }
          }
        }

        if (this.options.el[0] === '.' && this.options.el[0] !== null || this.options.el[0] === '#') {
          btnOpener = this.options.el;
          d.querySelectorAll(btnOpener).forEach(el => {
            el.addEventListener('click', this.open.bind(this, el))
          });
        } else {
          throw 'Please put a class or id element'
        }
      }

    })();

    const myModal = new Modal({
      el: '#btn1',
      className: 'gwapo',
      minWidth: 580,
      maxWidth: 900
    });

    const myModal2 = new Modal({
      el: '#btn2',
      className: 'cute',
      minWidth: 320,
      closeBtn: '<span class="icon icon-close">Close</span>'
    });

  </script>
</body>
</html>